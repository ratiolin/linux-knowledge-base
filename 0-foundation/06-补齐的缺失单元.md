# 最值得补齐的缺失单元
> 目标：把课程缺失点，转成与你现有仓库一致的 **能力项 → 题库/演练 → 证据产物**。  
> 原则：**无产物不算完成**；任何变更/修复必须具备 **验证点 + 回滚点 + 留痕**。  
> 命名：遵循《命名规范》（日期 `YYYYMMDD`；报告在 `5-reports/` 带日期；制度/流程资产在 `1-docs/` 不带日期）。

---

## A. 包管理补丁（APT/dpkg 为主，跨发行版为可选）
### A1｜能力定义（对标岗位）
- 能在 **Ubuntu/Debian** 上完成：安装/升级/降级/锁版本/回滚/排查依赖问题（最小可用）。
- 能回答并处理：
  - “为什么装不上/升级失败？”（依赖冲突、源问题、锁、残留配置）
  - “升级后服务坏了怎么办？”（快速定位变更、回滚到可用版本、验证恢复）

### A2｜最低等级（建议）
- **O**：按 Runbook 能完成常见操作  
- **Ow**：遇到冲突能定位并恢复（含回滚与验证）

### A3｜必须产物（资产化）
放入 `1-docs/`（长期资产，不带日期）：
- `1-docs/RUNBOOK/apt.md`：安装/升级/锁定/回滚/源检查的最小流程
- `1-docs/RUNBOOK/dpkg.md`：.deb、残留、数据库修复、常见错误处理
- `1-docs/CHECKLIST/package.md`：包管理排障 L1 清单（“先看什么、再做什么”）
- `1-docs/POLICIES/repo-policy.md`：源配置与变更规则（例如：允许哪些源、变更需记录）

### A4｜题库场景（可注入、可恢复、可重复）
放入 `2-labs/scenarios/`：
- `SC11_apt_dependency_conflict.md`：依赖冲突导致安装失败
- `SC12_apt_repo_misconfig.md`：源配置错误/过期导致更新失败
- `SC13_pkg_upgrade_break_service.md`：升级后服务无法启动（systemd 失败）

注入脚本放 `2-labs/inject/`：
- `S11_apt_break_dependencies.sh`
- `S12_apt_bad_sources_list.sh`
- `S13_pkg_upgrade_break_service.sh`

### A5｜证据（报告留痕）
放入 `5-reports/`：
- 变更记录：`change-record-YYYYMMDD-01-infra-apt-upgrade.md`
- 事故演练：`incident-sim-YYYYMMDD-01-infra-apt-install-fail.md`
- 专项核查：`infra-verification-YYYYMMDD-01-package-sources.md`

验收要点（写进报告 Verify）：
- 关键命令输出（`apt policy`、`apt-cache policy`、`dpkg -l`、`journalctl -u <svc>`）
- 回滚后健康检查通过（用户路径/服务状态/关键端口）

---

## B. 存储与文件系统补丁（分区/挂载/ext4/LVM）
> 这是你当前体系里“事故概率高、证据价值高、面试好讲”的缺口：磁盘满、inode 满、挂载丢、扩容失败、误格式化等。

### B1｜能力定义（对标岗位）
- 能完成：新增磁盘/分区 → 格式化 → 挂载（持久化） → 容量监控 → 安全扩容（LVM 优先）。
- 能处理典型事故：
  - 磁盘空间增长（含 inode）、日志爆炸
  - `/etc/fstab` 错误导致重启后无法启动/无法挂载
  - LVM 扩容后文件系统未扩、或扩错卷

### B2｜最低等级（建议）
- **O**：按 Checklist 能正确挂载与扩容（不追求优化）
- **Ow**：能在事故中恢复并留下可复盘证据（含“如何避免再次发生”）

### B3｜必须产物（资产化）
放入 `1-docs/`：
- `1-docs/SOP/storage.md`：新增盘/分区/挂载/权限边界（谁能动 fstab）
- `1-docs/RUNBOOK/disk-full.md`：磁盘满处理（定位→清理→防复发）
- `1-docs/RUNBOOK/fstab-rescue.md`：fstab 错误/挂载失败的恢复路径
- `1-docs/RUNBOOK/lvm-expand.md`：LVM 扩容（PV/VG/LV→扩文件系统→验证）
- `1-docs/CHECKLIST/storage.md`：存储/挂载变更清单（含回滚点）

### B4｜题库场景（可注入、可恢复、可重复）
`2-labs/scenarios/`：
- `SC21_disk_fill_log_burst.md`：日志爆炸导致磁盘满
- `SC22_inode_exhausted.md`：小文件过多导致 inode 满
- `SC23_fstab_misconfig_boot_fail.md`：fstab 错误导致启动/挂载失败
- `SC24_lvm_expand_wrong_target.md`：扩错 LV 或忘记扩文件系统

`2-labs/inject/`：
- `S21_disk_fill_log_burst.sh`
- `S22_inode_bomb.sh`
- `S23_fstab_bad_entry.sh`
- `S24_lvm_expand_misstep.sh`

### B5｜证据（报告留痕）
`5-reports/`：
- 专项核查：`infra-verification-YYYYMMDD-01-mounts-and-fstab.md`
- 事故演练：`incident-sim-YYYYMMDD-01-infra-disk-full.md`
- 变更记录：`change-record-YYYYMMDD-01-infra-lvm-expand-var.md`

验收要点：
- 变更前后对照（`lsblk`、`df -hT`、`df -i`、`mount`、`blkid`）
- 持久化成功（重启后仍正确挂载）
- 回滚策略明确（撤销 fstab、恢复快照/备份、救援入口）

---

## C. System Rescue 补丁（救援/引导/恢复）
> 你已有“备份与恢复演练”，但缺少“系统层救援”：当系统启动不了、挂载不了、root 读不了时如何恢复。

### C1｜能力定义（对标岗位）
- 能进入救援环境（recovery mode / live ISO / rescue shell）。
- 能完成最小救援动作：挂载根分区 → chroot → 修复 fstab/引导/权限 → 重启验证。
- 能把“救援路径”写成 1 页 Runbook，别人照做也能救回机器。

### C2｜最低等级（建议）
- **O**：按 Runbook 能完成救援
- **Ow**：面对不同根因能快速收敛并恢复（TTD/TTR 受控）

### C3｜必须产物（资产化）
`1-docs/`：
- `1-docs/RUNBOOK/system-rescue.md`：统一救援路径（入口→挂载→chroot→修复→验证）
- `1-docs/CHECKLIST/rescue.md`：救援前检查清单（避免二次伤害）
- `1-docs/POLICIES/rescue-policy.md`：救援动作权限与留痕规范（谁可做、做完要留下些什么）

### C4｜题库场景（可注入、可恢复、可重复）
`2-labs/scenarios/`：
- `SC31_boot_fail_fstab.md`：fstab 导致启动失败（与存储补丁形成联动）
- `SC32_root_ro_filesystem.md`：root 只读（模拟文件系统错误/挂载异常）
- `SC33_grub_misconfig.md`：引导配置错误（最低限度覆盖）

`2-labs/inject/`：
- `S31_boot_fail_fstab.sh`
- `S32_root_ro.sh`
- `S33_grub_misconfig.sh`

### C5｜证据（报告留痕）
`5-reports/incidents/`：
- `incident-sim-YYYYMMDD-01-infra-system-rescue.md`

验收要点：
- 救援时间线（T0/T1/T2…）清晰
- 每一步有“为何做/预期现象/实际现象”
- 重启后核心服务健康检查通过（systemd + 关键端口 + 日志无爆炸）

---

## D. Git 最小补丁（为“资产可审计/可追溯”服务）
> 你的体系高度强调“资产化 + 审计”，但 Git 训练缺失会让资产沉淀失去“时间维度证据”。

### D1｜能力定义（对标岗位）
- 能用 Git 管理：SOP/Runbook/Checklist/脚本/配置样本。
- 能完成最小协作流程：提交规范、回滚、差异审阅（哪怕只有你一个人，也要模拟 reviewer）。

### D2｜最低等级（建议）
- **O**：会用 `status/add/commit/log/diff/restore` 完成日常版本管理
- **Ow**：能用 `revert`/`reset`（谨慎）处理误提交，能写出“可审计”的提交信息

### D3｜必须产物（资产化）
`1-docs/`：
- `1-docs/POLICIES/git-policy.md`：分支/提交/回滚的最低规范（单人也按双人写）
- `1-docs/CHECKLIST/git.md`：提交前检查（敏感信息、命名、可复现）

建议提交信息格式（示例）：
- `docs(runbook): add disk-full runbook`
- `labs(inject): add S21_disk_fill_log_burst`
- `reports(incident): add incident-sim-20260115-01-infra-disk-full`

### D4｜题库场景（可注入、可恢复、可重复）
`2-labs/scenarios/`：
- `SC41_git_revert_bad_change.md`：一次错误 SOP/脚本变更导致演练失败，要求用 revert 恢复并验证
- `SC42_secret_scan.md`：模拟误提交敏感占位符，要求定位并清理历史（训练“预防优先”）

### D5｜证据（报告留痕）
`5-reports/`：
- `infra-verification-YYYYMMDD-01-repo-audit.md`（仓库审计：命名、结构、敏感信息、可读性）
- `change-record-YYYYMMDD-01-infra-repo-structure.md`（结构/规范变更也应留痕）

---

## 落地节奏（不增加负担的最小排程）
> 目标：让补丁内容进入你的 PDCA 与题库体系，而不是“学过就算”。

### 7 天最小闭环（建议）
- Day 1–2：A（APT/dpkg）— 写 `RUNBOOK/apt.md` + 做 1 个 `incident-sim`
- Day 3–4：B（存储/挂载/LVM）— 写 `RUNBOOK/disk-full.md` + 做 1 个 `change-record`
- Day 5：C（System Rescue）— 写 `RUNBOOK/system-rescue.md` + 做 1 个 `incident-sim`
- Day 6：D（Git）— 写 `git-policy.md` + 做 1 次 repo audit 记录
- Day 7：抽样复盘：从 4 个补丁里选 1 个场景复做一次（追求速度与一致性）

---

## 你会得到什么（与岗位验收直接对齐）
- **Outcome**：可量化的 TTD/TTR（包故障/磁盘故障/救援）
- **Process**：每次变更都有验证/回滚/留痕
- **Asset**：四个“高频高价值”资产域补齐，仓库可交接、可审计、可面试展示
