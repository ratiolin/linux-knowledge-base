# Environments Architecture｜三域最小企业模拟

## 1. 文档目的

本文件用于说明当前单机环境下的三域划分（Sandbox / Staging / Prod），
其目标不是实现资源级隔离，而是**验证变更必须经过非生产环境的流程约束**。

---

## 2. 三域定义

### 2.1 Sandbox

**用途**

- 临时试验
- 验证命令、配置、思路
- 允许破坏

**约束**

- 不要求记录
- 不要求回滚
- 不保证稳定

---

### 2.2 Staging

**用途**

- 验证即将进入生产的变更
- 行为验证
- 风险前置暴露

**特征**

- 配置尽量与 Prod 保持一致
- 数据不要求完全一致
- 不对外提供正式服务

**访问方式**

- 本机端口访问（HTTP）
- 不使用生产证书

---

### 2.3 Prod

**用途**

- 对外正式服务
- 承载真实用户与数据

**约束**

- 禁止直接实验性修改
- 所有变更必须先经过 Staging 验证
- 必须具备回滚方案

---

## 3. 当前实现方式（单机最小实现）

```text
/home/ratio/mattermost/
└── environments/
    ├── sandbox/
    ├── staging/
    │   └── docker-compose.yml
    └── prod/
        └── docker-compose.yml
```
说明：

所有环境共用同一台主机

不引入额外软件或集群

通过目录与端口区分环境

## 4. 环境差异约束（明确允许的差异）
Staging 相对于 Prod，仅允许以下差异：

端口映射不同（避免冲突）

容器名称不同（避免混淆）

数据目录不同（防止污染）

除此之外，不主动引入额外差异。

## 5. 设计原则总结
本设计的核心不是“环境数量”

而是变更路径的存在性

目标是证明：
生产环境不是直接修改的第一站

## 6. 状态
架构版本：v1.0

状态：已实施