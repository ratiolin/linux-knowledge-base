# 事件响应 SOP（Incident SOP）

> 来源：`训练方案.md` 的方法论沉淀，并与“资源/状态/队列/边界”心智模型对齐。  
> 目的：把排障从“会敲命令”固化为“可审计、可复盘、可复制”的工程流程。

---

## 1. 核心原则：资源 + 状态 + 队列 + 边界

任何问题必须能落位到以下四个维度之一（或其组合）：
- **资源**：CPU / 内存 / 磁盘空间与 inode / IO / 网络 / FD 等是否不足或被异常消耗？
- **状态**：服务/进程/连接是否处在错误状态（崩溃、僵死、锁住、等待）？
- **队列**：请求/任务是否在某处排队（run queue、连接队列、IO 队列、应用队列）？
- **边界**：权限、路径、端口、ACL、配额、cgroup、ulimit 等边界条件是否被触发？

---

## 2. 开局三问（强制）

1) **用户感知是什么？**（失败路径在哪里：DNS→TCP→TLS→HTTP→业务？）  
2) **影响范围多大？**（单点/全量；新用户/老用户；某接口/全站）  
3) **最近变更是什么？**（发布/配置/证书/权限/计划任务/容量变化）

---

## 3. L1 起手：3–5 分钟收敛假设（固定顺序）

L1 的目标不是“找到根因”，而是：
- 把问题收敛到 **3–5 个可验证假设**；
- 形成 **系统语言的一句话结论**；
- 给出 **下一步验证清单**。

> 具体命令与检查点见 `docs/CHECKLIST/incident_L1.md`。

---

## 4. L2：假设 → 验证 → 最小修复 → 回滚

- 列出 3–5 个高优先级假设（按可能性×影响）
- 每个假设都必须有：验证动作 + 预期现象（验证失败如何解释）
- 选择最小干预修复动作，并显式写出：
  - 风险点（可能误伤什么）
  - 回滚点（如何回到变更前）
  - 验证点（如何证明恢复）

---

## 5. 结束条件与复盘

### 5.1 结束条件（不满足不算结束）
- 用户路径恢复（不仅是服务 active）
- 根因说明到“资源/状态/队列/边界”的某个落点
- 事件记录完成（时间线、假设表、验证证据、修复与回滚）
- 至少一项改进落地：Runbook/Checklist/监控阈值/容量策略/流程补丁

### 5.2 复盘输出（模板）
建议使用 `reports/incidents/` 下的事件记录模板（见仓库 README）。

---

## 6. 结论写作纪律（摘要）
- 结论必须可验证，禁止“可能/大概/应该”
- 每条命令必须说明“在否定哪个假设”
- 统一时间线（T0/T1/T2…），避免描述漂移

> 详见 `docs/POLICIES/incident-writing.md`。

---

## 7. 参考（原始内容来源）
以下内容由旧文档抽取并固化为 SOP：
- `# 运维排障训练方案`（旧文件标题）
