# Ubuntu 训练计划（总纲）— 单机小企业真实流程模拟 + 肌肉记忆训练（LLM 外脑/教练）

> 适用对象：计算机相关背景，目标岗位为 Linux 系统管理员 / 初级运维。  
> 训练边界：本计划以 **Ubuntu 单机** 为载体，覆盖“小企业日常真实流程”的核心面向（账号权限、变更、发布、巡检、备份恢复、排障、基础安全、可观测性）。  
> 核心原则：**权威事实可回溯、动作流程可重复、结果可衡量、过程可审计、产物可复用**。

---

## 0. 这套文档怎么用（四件套）
本训练体系只保留并长期维护 4 个文件，避免版本漂移：

1. `ubuntu训练计划.md`（本文件）：唯一入口与总纲（架构、环境、节奏、验收、资产结构、参考资料与规则）。
2. `背景知识.md`：心智模型与“系统语言”（你在排障/巡检时用来描述系统的稳定语义）。
3. `故障排查肌肉记忆.md`：排障题库与固定动作序列（训练“顺序 + 检查点 + 留痕 + 回滚”）。
4. `运维能力.md`：能力矩阵与验收映射（能力项 → 证据 → 题库 → 参考资料）。

> 你可以把它们放入一个 Git 仓库，后续所有 SOP/Runbook/脚本都在仓库内迭代。

---

## 1. 训练目标（岗位可用的最低交付）
训练结束时，你应能做到：

- **稳定执行**：账号/权限、变更、发布、巡检、备份恢复等流程不走样（在疲劳/压力下仍能正确）。
- **可排障**：常见事故可在限定时间内恢复（并留下可复盘记录）。
- **可审计**：每次操作可追溯（命令记录、配置 diff、验证点、回滚点）。
- **可资产化**：沉淀 SOP/Runbook/Checklist 与小脚本，能交给他人复用。
- **LLM 时代能力**：把 LLM 输出当“候选”，以 man/官网/实验验证为准，能够评审与纠错。

---

## 2. 单机环境的“真实性策略”
单机无法完全复刻生产，但可以通过“结构等价”逼近真实工作：

- **多服务**：Web（Nginx）+ 业务应用（systemd 托管）+ 数据库（PostgreSQL/MySQL 二选一）+ 监控/日志 + 备份。
- **多身份/多权限边界**：人（it/dev/finance/hr）+ 服务账号（service-*），通过用户/组/目录权限实现隔离。
- **三域划分**：Sandbox（随意试错）/ Staging（仿真域）/ Exam（考核域）——即便都在同一台机器上。
- **故障可注入、可恢复、可重复**：把“经验”前置为“情景训练”，形成题库与复盘资产。

---

## 3. 小企业业务模拟（建议默认画像）
假设你维护一家 20–50 人小企业的内部系统（示例：AcmeCo）：

### 3.1 业务组件（建议默认）
- 反向代理：Nginx
- 应用：一个简单 Web 服务（Python Flask/Node/静态站点均可），必须：
  - 由 systemd 托管
  - 有独立日志目录
  - 有健康检查（HTTP 或 CLI）
- 数据库：PostgreSQL（或 MySQL）
- 文件共享（二选一）：Samba（办公更常见）/ NFS（技术团队更常见）
- 监控/可视化（二选一）：
  - 轻量：Netdata
  - 标准：Prometheus + node_exporter + Grafana（单机版）
- 备份：rsync + tar + 校验（可选 Restic）
- 基础安全：OpenSSH + UFW（可选 fail2ban）

> 关键不是“装很多”，而是这些组件能覆盖真实流程与常见事故类型。

### 3.2 组织角色（权限模型）
- `it-admin`：运维管理员（受控 sudo，必须可审计）
- `dev`：开发（能部署到 staging；生产发布必须走流程）
- `finance`：财务（只读报表/受限共享目录）
- `hr`：人事（只访问 HR 共享目录）
- `service-web` / `service-app` / `service-db` 等：服务账号（最小权限）

---

## 4. 训练环境设计（三域）
> 同一台主机上实现即可，核心是“可复现与可比较”。

### 4.1 Sandbox（随意试错）
- 用于命令熟练、脚本练习、破坏性实验。
- 允许失败；必要时用快照/备份还原。

### 4.2 Staging（仿真域）
- 尽量按“生产方式”配置权限、服务、监控、日志、备份。
- 故障注入与恢复演练主要发生在此域。

### 4.3 Exam（考核域）
- 与 Staging 同构，但题目未知、初始状态固定（可用重置脚本恢复到基线）。
- 用于对比指标（TTD/TTR、流程合规、产物质量），避免“背答案”。

### 4.4 单机实现两种方式（任选其一）
- **方式 A（更简单）**：用端口/目录/不同 systemd unit 区分（如 app-staging:8081，app-prod:8080）。
- **方式 B（更真实，可选）**：用容器/Compose 拆分 staging/prod（但仍在单机运行）。

---

## 5. 训练闭环（PDCA）与产物要求
### 5.1 PDCA（每次训练都走闭环）
- Plan：本次主题 + 成功标准 + 时间盒
- Do：执行任务/排障演练（全程留痕）
- Check：对照 Checklist 与权威来源验收；LLM 做“评审/对抗”
- Act：固化为 SOP/Runbook/脚本；补充题库；形成回归用例

### 5.2 “无产物不算完成”
每次训练至少产出一种可复用资产：
- SOP 更新 / Runbook 新增 / Checklist 修订 / 故障题新增 / 小脚本改进 / 复盘报告

---

## 6. 肌肉记忆训练体系（四类流程）
> 四类流程都必须形成：**默认动作序列 + 检查点 + 留痕 + 回滚**。

1) 身份与权限（IAM）：入职/离职/临时权限/服务账号/SSH key 生命周期  
2) 变更与发布（Change/Release）：配置变更、应用发布、证书轮换、回滚  
3) 巡检与可观测性（Inspection/Observability）：巡检顺序固定、输出格式固定、告警响应框架固定  
4) 排障与恢复（Incident/Recovery）：统一排障框架（见《故障排查肌肉记忆.md》）+ 故障库

---

## 7. LLM（外脑/教练）集成规则（可靠性来自边界）
### 7.1 角色定位
- **外脑**：解释概念、整理候选步骤、对照版本差异、生成 Checklist 草案
- **教练**：评审你的方案/排障记录（找遗漏、风险点、验证缺口、回滚缺口）
- **对抗者**：生成故障组合与提问压力（但注入动作由你在隔离域执行）

### 7.2 硬边界（必须遵守）
- LLM 输出一律视为 **候选**，不能当最终事实源。
- 涉及参数/行为/边界条件：以 **man pages / 官方文档 / 实验验证** 为准。
- 任何变更动作必须具备：**验证点 + 回滚点 + 留痕**。
- 不向 LLM 提供敏感信息（密钥、真实业务数据、真实公网地址等全部用占位符）。

### 7.3 建议的结构化输出格式（要求 LLM 按此返回）
- 假设清单（按优先级）
- 验证步骤（命令 + 预期现象）
- 风险点（误伤点/副作用）
- 回滚步骤（可执行、可验证）
- 需要对照的权威来源条目（man/官网链接标题即可）

---

## 8. 自动化演进（来自训练到自动化的安全路径）
> 目标：先把流程“固化”，再把固化流程“自动化”。禁止跳级。

### 阶段 1：判定树化（不写自动化，只写 if/else）
- 把排障/巡检动作写成“条件 → 动作 → 验证 → 禁止动作 → 升级条件”
- 产物：`docs/POLICIES/decision-trees.md`

### 阶段 2：只读自动化（自动采集，不自动改系统）
- 自动收集：指标、日志、配置摘要、版本、近期变更线索
- 自动生成：事件初稿（系统语言）与下一步验证清单
- 产物：`scripts/collect.sh`、`reports/incidents/*.md`

### 阶段 3：有限自动行动（只做保护性动作）
仅当同时满足：
1) 行为可回滚；2) 不改变系统状态本质；3) 人可随时介入  
例：临时隔离、限流、自动附上下文通知。  
> 这一步不是“修问题”，而是“保护系统”。

---

## 9. 参考资料仓库（一次性下载，长期可用）
> 目的：建立“事实层”的离线锚点，减少二手教程污染。

建议纳入本地资料库的类别（只列方向，具体链接可在仓库 README 维护）：
- man-pages 项目、Ubuntu manpages
- systemd 文档与关键 man page（systemd.unit/systemd.service/journalctl 等）
- Linux 内核文档（/proc、调度、内存、网络相关）
- OpenSSH、Nginx、PostgreSQL/MySQL 官方文档
- 事故时间线与复盘库（用于培养“系统语言”与复盘写作）

---

## 10. 验收（岗位导向）
### 10.1 三类验收：Outcome / Process / Asset
- Outcome：TTD（定位）/ TTR（恢复）/ 恢复质量（是否二次事故）
- Process：是否遵循默认流程（备份→变更→验证→留痕→回滚预案）
- Asset：SOP/Runbook/Checklist 是否可复用、可审计、可追溯权威依据

### 10.2 最小可用标准（建议）
- IAM：5 个典型场景零越权、零遗漏、可复盘
- 发布与回滚：3 次演练，至少 1 次触发回滚且回滚后健康检查通过
- 排障：10 题 ≥8 题在时间盒内恢复，每题有事件记录与复盘
- 备份恢复：至少 2 次完整恢复演练（配置 + 数据），可证明可用
- 巡检：连续 2 周巡检记录一致，能发现并处理 ≥3 类趋势性问题（磁盘增长、日志异常、证书到期预警等）

---

## 11. 仓库建议结构（Git）
```
ops-training/
  ubuntu训练计划.md
  背景知识.md
  故障排查肌肉记忆.md
  运维能力.md
  docs/
    SOP/
    RUNBOOK/
    CHECKLIST/
    POLICIES/
  labs/
    scenarios/        # 故障题描述（Exam 用）
    inject/           # 故障注入（Staging 用）
    reset/            # 环境重置（Exam 用）
  configs/
  scripts/
  reports/
    incidents/
    inspections/
    backups/
```

---

## 12. 附录：统一模板（建议纳入 docs/TEMPLATES/）
- 变更记录（Change Record）
- 事件记录（Incident Record）
- 巡检报告（Inspection Report）
- 备份演练报告（Backup/Restore Report）

> 模板内容在《故障排查肌肉记忆.md》与《运维能力.md》里有对应要求与映射。
